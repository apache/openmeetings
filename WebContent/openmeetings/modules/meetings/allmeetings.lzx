<?xml version="1.0" encoding="UTF-8" ?>
<library>

<class name="allmeetings" extends="baseContentView"  bgcolor="white">
	<attribute name="finishedTabsQuantity" type="number" value="0"/>	
	<attribute name="clickedButton" value="null"/>
			
	<method name="updateFinishedTabsQuantity">
		this.finishedTabsQuantity = this.finishedTabsQuantity + 1;

		if (this.finishedTabsQuantity == 3) {
			if (clickedButton != null) {
				lz.Cursor.unlock();

				clickedButton.onclick.sendEvent();
			}
		}
	</method>
	
	<handler name="ontabcontentleave">
		canvas._chatcontentRPC = null;
		canvas.thishib.removeClientFromChatNotification.doCall();
	</handler>
    
	<simplelayout axis="y" spacing="2" />	
	<!-- label: meeting room -->
	<labelText fontstyle="bold" y="10" labelid="128" resize="true" width="200" />
	
	
	<!-- public rooms -->
	<tabs>
		<tabpane text="Public Meetings" >
			<view>
		    
				<netRemoteCallHib name="removeClientFromChatNotification" funcname="chatservice.removeClientFromChatNotification"	
					remotecontext="$once{ canvas.thishib }" >      
					<handler name="ondata" args="value">
						if ($debug) Debug.write("removeClientFromChatNotification: ",value);
						this.parent.destroy();
					</handler>
				</netRemoteCallHib>
    
	  
				<view y="4" x="4" >
					<handler name="oninit">
						canvas.thishib.roomtype = "public";
						this.getRoomsPublic.doCall();
					</handler>
	        
					<netRemoteCallHib name="getRoomsPublic" funcname="conferenceservice.getRoomsPublic" 
						remotecontext="$once{ canvas.thishib }" >   
						<netparam>
							<method name="getValue">
								return canvas.sessionId;
							</method>
						</netparam>  
						<netparam>
							<method name="getValue">
								return 1;
							</method>
						</netparam>  
						<handler name="ondata" args="value">	
						<![CDATA[
							if ($debug) Debug.write("getRoomsPublic: ", value);
							if (value != null) {
								for (var eg = 0; eg < value.length; eg++) {
									var time = value[eg].starttime.getHours()
											+ ':' + value[eg].starttime.getMinutes()
											+ ' ' + value[eg].starttime.getDate()
											+ '.' + (value[eg].starttime.getMonth() + 1)
											+ '.' + value[eg].starttime.getFullYear();
											
									new lz.roomListItem(parent.inn.inn.inn,
											{
												roomClassName:canvas.conferenceRoomModule,
												currentusers : value[eg].currentusers,
												obj : value[eg],
												ispublic : true,
												roomid : value[eg].rooms_id,
												starttime : time,
												roomname : value[eg].name
											});
								}
							}
							parent.parent.parent.parent.parent
									.updateFinishedTabsQuantity();
						]]>	        	          				
						</handler>	
					</netRemoteCallHib>

					<!-- inn.inn.inn view would be setted object by above ondata hander. -->
					<view name="inn" width="480" height="500" bgcolor="$once{ canvas.basebgcolorizer }" >
						<view name="inn" x="1" y="1" width="478" height="498" bgcolor="0xFFFFFF" clip="true" >
							<view name="inn" layout="axis:y;spacing:2"/>
							<vscrollbar />
						</view>
					</view>
				</view>
				<!-- description panel for eache room. right hand on this class view.
						roomListDetails class are declared in modules/conference/conference/roomListDetails.lzx.
							Mar 24 2008 commented by onokeiji@gmal.com
					 -->
				<roomListDetails x="510" y="4" name="_roomlistdetails" bgcolor="white" />
			</view>
		</tabpane>
	
	
		<!-- private Meetings -->	
		<tabpane text="Private Meetings" >
			<view>
	
				<!-- Declared conference rooms list -->
				<view y="4" x="4">
					<handler name="oninit">
						canvas.thishib.roomtype = "private";
						this.getRoomsByOrganisationAndType.doCall();
					</handler>    
	        
					<netRemoteCallHib name="getRoomsByOrganisationAndType" funcname="conferenceservice.getRoomsByOrganisationAndType" remotecontext="$once{ canvas.thishib }" >   
						<netparam>
							<method name="getValue">
								return canvas.sessionId;
							</method>
						</netparam>  
						<netparam>
							<method name="getValue">
								return hib.currentdomainObj.organisation_id;
							</method>
						</netparam>  
						<netparam>
							<method name="getValue">
								return 1;
							</method>
						</netparam>  
			
						<handler name="ondata" args="value">	
						<![CDATA[
							if (value != null) {
								for (var eg = 0; eg < value.length; eg++) {
									new lz.roomListItem(parent.inn.inn.inn,
											{
												roomClassName:canvas.conferenceRoomModule,
												currentusers : value[eg].room.currentusers,
												obj : value[eg],
												ispublic : false,
												roomid : value[eg].room.rooms_id,
												starttime : parseDateToStringTime(value[eg].room.starttime),
												roomname : value[eg].room.name
											});
								}
							}

							parent.parent.parent.parent.parent
									.updateFinishedTabsQuantity();
						]]>	        	          				
						</handler>	
					</netRemoteCallHib> 
	 
					<!-- inn.inn.inn view would be setted object by above ondata hander. -->
					<view name="inn" width="480" height="500" bgcolor="$once{ canvas.basebgcolorizer }" >
						<view name="inn" x="1" y="1" width="478" height="498" bgcolor="0xFFFFFF" clip="true" >
							<view name="inn" layout="axis:y;spacing:2"/>
							<vscrollbar />
						</view>
					</view>
				</view>
	
				<!-- description panel for eache room. right hand on this class view.
						roomListDetails class are declared in modules/conference/conference/roomListDetails.lzx.
							Mar 24 2008 commented by onokeiji@gmal.com
					 -->
				<roomListDetails x="510" y="4" name="_roomlistdetails" bgcolor="white" />
			</view>
  			
		</tabpane>
		
		<!-- Appointed Meetings -->
		<tabpane text="My Meetings" >
			
			<!-- Declared conference rooms list -->
			<view y="4" x="4">
				<handler name="oninit">
					canvas.thishib.roomtype = "public";
					this.getAppointedRooms.doCall();
				</handler>    
	        
				<netRemoteCallHib name="getAppointedRooms" funcname="conferenceservice.getAppointedMeetings" remotecontext="$once{ canvas.thishib }" >   
					<netparam>
						<method name="getValue">
							return canvas.sessionId;
						</method>
					</netparam>  
					<netparam>
						<method name="getValue">
							return 1;
						</method>
					</netparam>  
			
			
					<handler name="ondata" args="value">	
					<![CDATA[
						if ($debug) Debug.write("getRoomsPublic: ", value);
						if (value != null) {
							for (var eg = 0; eg < value.length; eg++) {
								var time = value[eg].starttime.getHours()
										+ ':'
										+ value[eg].starttime.getMinutes()
										+ ' '
										+ value[eg].starttime.getDate()
										+ '.'
										+ (value[eg].starttime.getMonth() + 1)
										+ '.'
										+ value[eg].starttime.getFullYear();
								new lz.roomListItem(parent.inn.inn.inn, 
									   {
									        roomClassName:canvas.conferenceRoomModule,
											currentusers : value[eg].currentusers,
											obj : value[eg],
											ispublic : true,
											roomid : value[eg].rooms_id,
											starttime : time,
											roomname : value[eg].name
										});
							}

							parent.parent.parent.parent
									.updateFinishedTabsQuantity();
						}
					]]>		        	          				
					</handler>	
				</netRemoteCallHib> 
	 
				<!-- inn.inn.inn view would be setted object by above ondata hander. -->
				<view name="inn" width="480" height="500" bgcolor="$once{ canvas.basebgcolorizer }" >
					<view name="inn" x="1" y="1" width="478" height="498" bgcolor="0xFFFFFF" clip="true" >
						<view name="inn" layout="axis:y;spacing:2"/>
						<vscrollbar />
					</view>
				</view>
			</view>
	
			<!-- description panel for eache room. right hand on this class view.
					roomListDetails class are declared in modules/conference/conference/roomListDetails.lzx.
						Mar 24 2008 commented by onokeiji@gmal.com
				 -->
			<roomListDetails x="510" y="4" name="_roomlistdetails" bgcolor="white"/>
			
		</tabpane>
	</tabs>
	
</class>


</library>